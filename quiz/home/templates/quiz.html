<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossorigin="anonymous">

    <title>Quiz APP</title>
    <style>
        #timer {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
        }

        #progressBarContainer {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="container mt-5 pt-5">
        <div class="col-md-6 mx-auto">
            <h3>Give Quiz</h3>
            <hr>
            <!-- Display Timer -->
            <div id="timer">Timer: <span id="timerValue">10</span>s</div>
            <!-- Question Container -->
            <div id="questionContainer">

            </div>
            <!-- Navigation Buttons -->
            <div class="mt-3">
                <button id="prevBtn" class="btn btn-secondary mr-2">Previous</button>
                <button id="nextBtn" class="btn btn-primary">Next</button>
            </div>
            <!-- Progress Bar -->
            <div id="progressBarContainer" class="progress mt-5">
                <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0"
                     aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
    </div>
</div>

<!-- Include jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        const questionContainer = $('#questionContainer');
        let currentQuestionIndex = 0;
        let questions = [];
        let timerInterval;
        let timerValue = 10;

        function getQuestions() {
            $.ajax({
                url: `/api/get-quiz/?category={{ category }}`,
                method: 'GET',
                success: function (result) {
                    questions = result.data;
                    showQuestion(currentQuestionIndex);
                    startTimer();
                    updateProgressBar();
                }
            });
        }

        function showQuestion(index) {
            questionContainer.empty();
            const question = questions[index];
            const questionDiv = $('<div></div>');
            questionDiv.append(`<p>${question.question}</p>`);
            $.each(question.answers, function (index, answer) {
                let input = $('<input>').attr({
                    type: 'radio',
                    name: 'exampleRadios',
                    value: answer.answer
                });
                let label = $('<label></label>').text(answer.answer);
                let div = $('<div></div>').addClass('form-check');
                div.append(input, label);
                questionDiv.append(div);
            });
            questionContainer.append(questionDiv);
        }

        $('#nextBtn').click(function () {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
                resetTimer();
                updateProgressBar();
            }
        });

        $('#prevBtn').click(function () {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
                resetTimer();
                updateProgressBar();
            }
        });

        function startTimer() {
            timerInterval = setInterval(function () {
                timerValue--;
                $('#timerValue').text(timerValue);
                if (timerValue === 0) {
                    clearInterval(timerInterval);
                    // Handle time up event
                    console.log("Time's up!");
                    goToNextQuestion();
                }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerValue = 10;
            $('#timerValue').text(timerValue);
            startTimer();
        }

        function goToNextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
                resetTimer();
                updateProgressBar();
            }
        }

        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            $('#progressBar').css('width', progress + '%').attr('aria-valuenow', progress);
        }

        getQuestions();
    });
</script>
</body>
</html>
